version: '3.4'

services:
    node:
        build: './docker/node/'
        image: 'carcel/skeleton/node:lts'
        environment:
            YARN_CACHE_FOLDER: '/home/yarn-cache'
        user: '${HOST_USER_IDS:-1000:1000}'
        volumes:
            - './:/srv/app'
            - '${HOST_YARN_CACHE_FOLDER:-~/.cache/yarn}:/home/yarn-cache'
            - '${HOST_YARN_CONFIG_FOLDER:-~/.yarn}:/.yarn'
            - '${HOST_YARN_CONFIG_FILE:-~/.yarnrc}:/.yarnrc'
        working_dir: '/srv/app'
        networks:
            - 'skeleton-front'

    front:
        image: 'nginx:alpine'
        labels:
            - 'traefik.docker.network=proxy'
            - 'traefik.frontend.rule=Host:skeleton.docker.local'
            - 'traefik.enable=true'
        volumes:
            - './public:/srv/app:ro'
            - './docker/nginx.conf:/etc/nginx/conf.d/default.conf:ro'
            - './docker/upload.conf:/etc/nginx/conf.d/upload.conf:ro'
        networks:
            - 'proxy'
            - 'skeleton-front'

networks:
    proxy:
        external: true
    skeleton-front:
